<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Chat</title>
</head>
<body>
    <h1>Chat Room</h1>

    <div id="chat-messages">
        <!-- Các tin nhắn sẽ được hiển thị tại đây -->
    </div>

    <textarea id="message-content" placeholder="Type your message here"></textarea>
    <button id="send-message">Send Message</button>

    <script>
        // Cấu hình URL của WebSocket (Cần đảm bảo đường dẫn chính xác)
        const roomId = "1"; // Thay bằng room_id thực tế
        const chatSocket = new WebSocket(
            `ws://${window.location.host}/ws/rooms/${roomId}/`
        );

        chatSocket.onopen = function(event) {
            console.log("Connected to WebSocket!");
        };

        // Khi nhận được tin nhắn từ server
        chatSocket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'message_handler') {
                const messageId = data.message_id;

                // Lấy thông tin tin nhắn từ server (có thể gọi API REST để lấy thông tin chi tiết)
                fetch(`http://127.0.0.1/api/chat/get_message/${messageId}/`)
                    .then(response => response.json())
                    .then(messageData => {
                        // Thêm tin nhắn vào DOM
                        const messageDiv = document.createElement('div');
                        messageDiv.innerText = messageData.content;
                        document.getElementById('chat-messages').appendChild(messageDiv);
                    });
            }
        };

        // Gửi tin nhắn đến server
        document.getElementById('send-message').onclick = function() {
            const messageContent = document.getElementById('message-content').value;

            // Gửi tin nhắn qua WebSocket
            chatSocket.send(JSON.stringify({
                'content': messageContent,
            }));

            // Xóa nội dung input sau khi gửi
            document.getElementById('message-content').value = '';
        };

        // Khi WebSocket đóng kết nối
        chatSocket.onclose = function(event) {
            console.log("Disconnected from WebSocket.");
        };
    </script>
</body>
</html>
