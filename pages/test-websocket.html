<!-- chat.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Room Chat</title>
</head>
<body>
    <div id="messages"></div>
    <textarea id="messageInput"></textarea>
    <button id="sendButton">Send</button>

    <script>
        const roomId = 1; // ID của phòng học bạn muốn kết nối
        const userToken = localStorage.getItem("token");

        if (!userToken) {
            alert("You need to login first!");
            window.location.href = "login.html";
        }

        // Kết nối WebSocket
        const socket = new WebSocket(`ws://127.0.0.1:8000/api/chat/ws/rooms/${roomId}/`);

        socket.onopen = function(e) {
            console.log('WebSocket connection established');
        };

        socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            const messageElement = document.createElement('div');
            messageElement.textContent = `${data.timestamp} - ${data.user}: ${data.message}`;
            document.getElementById('messages').appendChild(messageElement);
        };

        document.getElementById('sendButton').onclick = function() {
            const message = document.getElementById('messageInput').value;
            socket.send(JSON.stringify({'message': message}));
        };
    </script>
</body>
</html>
